<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>إدارة المحتوى الاحترافية | MAHER PRO</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* المتغيرات الأساسية القابلة للتغيير من الإدارة */
        :root {
            --primary-color: #bc202b;
            --bg-color: #0a0a0a;
            --surface-color: #161616;
            --text-color: #ffffff;
            --sub-text: #b1b1b1;
            --header-bg: #161616;
            --sidebar-bg: #161616;
            --radius: 15px;
            --ticker-bg: #bc202b;
            --ticker-text: #ffffff;
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Cairo', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body { 
            background: var(--bg-color); 
            color: var(--text-color); 
            transition: 0.5s; 
            overflow-x: hidden;
            width: 100%;
            height: 100vh;
            position: fixed; /* لمنع التكبير والتصغير المتصفح */
        }

        /* نظام الطبقات */
        .page-layer {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 10;
            overflow-y: auto;
            display: none;
            transition: transform 0.4s cubic-bezier(0.7, 0, 0.3, 1);
        }

        .active-layer { display: block; }

        /* الطبقة 1: الصفحة الرئيسية */
        header {
            height: 70px; background: var(--header-bg); display: flex; align-items: center;
            justify-content: space-between; padding: 0 5%; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .header-tools { display: flex; align-items: center; gap: 15px; }
        .tool-icon { cursor: pointer; font-size: 1.2rem; transition: 0.3s; color: var(--text-color); }
        
        /* شريط الخبر العاجل */
        .ticker-wrapper {
            width: 100%;
            background: var(--ticker-bg);
            color: var(--ticker-text);
            padding: 10px 0;
            overflow: hidden;
            white-space: nowrap;
            display: none;
            position: relative;
        }
        .ticker-text {
            display: inline-block;
            padding-right: 100%;
            animation: ticker-anim 20s linear infinite;
            font-weight: bold;
        }
        @keyframes ticker-anim {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* المحتوى الرئيسي */
        .main-content { padding: 15px; max-width: 1000px; margin: 0 auto; }
        
        .main-title-container { text-align: center; margin-bottom: 20px; }
        #display-main-title { font-size: 1.5rem; font-weight: 900; color: var(--primary-color); }
        #title-video-frame { width: 100%; max-width: 400px; aspect-ratio: 16/9; margin: 10px auto; display: none; border-radius: 10px; overflow: hidden; }

        .big-player-container { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: var(--radius); overflow: hidden; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        iframe, video { width: 100%; height: 100%; border: none; }

        .video-list-container { display: flex; flex-direction: column; gap: 10px; }
        .video-card { 
            display: flex; background: var(--surface-color); border-radius: 12px; 
            overflow: hidden; cursor: pointer; transition: 0.2s;
        }
        .video-card img { width: 140px; aspect-ratio: 16/9; object-fit: cover; }
        .video-card-info { padding: 10px; flex: 1; }
        .video-card-title { font-weight: 700; font-size: 0.9rem; margin-bottom: 5px; }
        .video-card-desc { font-size: 0.8rem; color: var(--sub-text); display: none; padding-top: 5px; border-top: 1px solid #333; }

        /* القائمة الجانبية */
        .sidebar {
            position: fixed; top: 0; bottom: 0; width: 280px;
            background: var(--sidebar-bg); z-index: 2000; transition: 0.4s;
            padding: 25px; box-shadow: 0 0 30px rgba(0,0,0,0.8);
            right: -100%;
        }
        .sidebar.active { right: 0; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1999; display: none; }

        .sidebar-profile-box { 
            background: #222; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px;
            position: relative; overflow: hidden;
        }
        .sidebar-img { width: 100px; height: 100px; border-radius: 10px; object-fit: cover; margin-bottom: 10px; cursor: pointer; }
        .sidebar-img-title { font-weight: 900; color: var(--primary-color); cursor: pointer; }
        .sidebar-img-desc { font-size: 0.8rem; color: var(--sub-text); display: none; margin-top: 10px; }

        /* الطبقة 2: تسجيل الدخول */
        #login-layer { z-index: 50; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); }
        .login-box { background: var(--surface-color); padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; }
        
        /* الطبقة 3: لوحة الإدارة */
        #admin-layer { z-index: 100; }
        .admin-header { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px;
            border-bottom: 1px solid #333;
        }
        .admin-btn-main { 
            background: var(--surface-color); border: 1px solid var(--primary-color); 
            padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;
        }
        .admin-btn-main i { font-size: 1.5rem; color: var(--primary-color); margin-bottom: 10px; display: block; }

        .admin-list { padding: 20px; }
        .admin-item { 
            background: var(--surface-color); padding: 15px; border-radius: 10px; 
            margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between;
            cursor: pointer;
        }

        /* الطبقة 4: نافذة الإضافة والتعديل */
        #editor-layer { z-index: 200; background: var(--surface-color); }
        .editor-container { padding: 25px; }
        .editor-header { font-weight: 900; font-size: 1.2rem; margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }

        /* العناصر العامة */
        input, textarea, select {
            width: 100%; padding: 12px; background: #222; border: 1px solid #444;
            color: #fff; border-radius: 10px; margin-bottom: 15px; outline: none;
        }
        .btn-save { background: var(--primary-color); color: #fff; padding: 15px; border: none; border-radius: 10px; width: 100%; font-weight: 900; cursor: pointer; margin-top: 10px; }
        .btn-cancel { background: #333; color: #fff; padding: 12px; border: none; border-radius: 10px; width: 100%; margin-top: 10px; cursor: pointer; }
        .btn-delete { background: #500; color: #fff; padding: 12px; border: none; border-radius: 10px; width: 100%; margin-top: 5px; cursor: pointer; }

        /* تخصيص الألوان */
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .color-input-box { display: flex; flex-direction: column; gap: 5px; font-size: 0.8rem; }
        
        /* روابط التواصل */
        .social-admin-item { display: flex; align-items: center; gap: 10px; background: #222; padding: 10px; border-radius: 10px; margin-bottom: 10px; }
        .social-admin-item i { width: 30px; text-align: center; font-size: 1.2rem; }

        /* الانتقال (3 ثواني) */
        #redirect-layer { position: fixed; inset: 0; background: #000; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .timer-circle { width: 80px; height: 80px; border-radius: 50%; border: 4px solid var(--primary-color); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 900; margin-top: 20px; }

    </style>
</head>
<body>

    <div id="redirect-layer">
        <h2 id="redir-text">جاري الانتقال...</h2>
        <div class="timer-circle" id="redir-timer">3</div>
    </div>

    <div id="layer-main" class="page-layer active-layer">
        <header id="main-header">
            <div style="display:flex; align-items:center; gap:12px">
                <i class="fas fa-bars tool-icon" onclick="App.toggleSidebar(true)"></i>
                <span id="ui-brand-name" style="font-weight:900;">MAHER PLATFORM</span>
            </div>
            <div class="header-tools">
                <i class="fas fa-search tool-icon" id="btn-search-ui" onclick="App.toggleSearch()"></i>
                <i class="fas fa-globe tool-icon" id="btn-lang-ui" onclick="App.showLangSwitcher()"></i>
                <i class="fas fa-moon tool-icon" id="btn-theme-ui" onclick="App.toggleTheme()"></i>
            </div>
        </header>

        <div id="ticker-top" class="ticker-wrapper"><div class="ticker-text" id="ui-ticker-text-top"></div></div>

        <div class="main-content">
            <div class="main-title-container" id="ui-title-container">
                <h1 id="display-main-title">العنوان الترحيبي</h1>
                <div id="title-video-frame"></div>
            </div>

            <div class="big-player-container" id="main-player-box">
                </div>

            <div id="ticker-mid" class="ticker-wrapper" style="margin-bottom:15px; border-radius:10px;"><div class="ticker-text" id="ui-ticker-text-mid"></div></div>

            <div class="video-list-container" id="ui-video-list">
                </div>
        </div>

        <div id="ticker-bottom" class="ticker-wrapper" style="position:fixed; bottom:0;"><div class="ticker-text" id="ui-ticker-text-bottom"></div></div>
    </div>

    <div class="sidebar-overlay" id="sidebar-overlay" onclick="App.toggleSidebar(false)"></div>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-profile-box">
            <img src="https://via.placeholder.com/100" id="ui-sidebar-img" class="sidebar-img" onclick="App.toggleSidebarDesc()">
            <div id="ui-sidebar-img-title" class="sidebar-img-title" onclick="App.toggleSidebarDesc()">معلومات العرض</div>
            <div id="ui-sidebar-img-desc" class="sidebar-img-desc"></div>
        </div>
        
        <div style="display:flex; flex-direction:column; gap:10px;">
            <div class="admin-item" style="background:#222" onclick="App.socialRedirect('whatsapp')"><i class="fab fa-whatsapp" style="color:#25D366"></i> واتساب</div>
            <div class="admin-item" style="background:#222" onclick="App.socialRedirect('facebook')"><i class="fab fa-facebook" style="color:#1877F2"></i> فيسبوك</div>
            <div class="admin-item" style="background:#222" onclick="App.socialRedirect('tiktok')"><i class="fab fa-tiktok"></i> تيك توك</div>
            <div class="admin-item" style="background:#222" onclick="App.socialRedirect('instagram')"><i class="fab fa-instagram" style="color:#E1306C"></i> انستغرام</div>
            <hr style="opacity:0.1; margin:10px 0">
            <div class="admin-item" onclick="App.showLogin()"><i class="fas fa-user-cog"></i> إدارة المحتوى</div>
        </div>
    </nav>

    <div id="login-layer" class="page-layer" style="display:none; flex-direction:column; justify-content:center; align-items:center;">
        <div class="login-box">
            <h2 style="text-align:center; margin-bottom:20px; color:var(--primary-color)">دخول المسؤول</h2>
            <div id="login-inputs-container">
                </div>
            <button class="btn-save" onclick="App.verifyLogin()">دخول</button>
            <button class="btn-cancel" onclick="App.hideLayer('login-layer')">إلغاء</button>
        </div>
    </div>

    <div id="admin-layer" class="page-layer">
        <div class="admin-header">
            <div class="admin-btn-main" onclick="App.openEditor('add-video')">
                <i class="fas fa-video"></i> إضافة فيديو جديد
            </div>
            <div class="admin-btn-main" onclick="App.openEditor('add-image')">
                <i class="fas fa-image"></i> إضافة صورة جديدة
            </div>
        </div>

        <div class="admin-list">
            <div class="admin-item" onclick="App.openEditor('theme')"><span>تغيير لون وخطوط الصفحة</span> <i class="fas fa-palette"></i></div>
            <div class="admin-item" onclick="App.openEditor('social')"><span>روابط التواصل الاجتماعي</span> <i class="fas fa-share-alt"></i></div>
            <div class="admin-item" onclick="App.openEditor('lang')"><span>تغيير لغة الصفحة</span> <i class="fas fa-language"></i></div>
            <div class="admin-item" onclick="App.openEditor('ticker')"><span>خبر عاجل</span> <i class="fas fa-bolt"></i></div>
            <div class="admin-item" onclick="App.openEditor('avatar')"><span>تغيير صورة العرض</span> <i class="fas fa-id-badge"></i></div>
            <div class="admin-item" onclick="App.openEditor('title-config')"><span>تغيير العنوان العلوي</span> <i class="fas fa-heading"></i></div>
            <div class="admin-item" onclick="App.openEditor('security')"><span>تغيير الدخول</span> <i class="fas fa-lock"></i></div>
            
            <div style="margin-top:20px; padding:10px; border-top:1px solid #333;">
                <h4 style="margin-bottom:10px;">إدارة المحتوى المضاف:</h4>
                <div id="admin-media-list"></div>
            </div>
            
            <button class="btn-save" style="background:#060; margin-bottom:50px;" onclick="App.finalSaveAll()">حفظ الإعدادات النهائية</button>
        </div>
    </div>

    <div id="editor-layer" class="page-layer">
        <div class="editor-container" id="editor-content">
            </div>
    </div>

    <script>
        const App = {
            // قاعدة البيانات الافتراضية
            db: {
                config: {
                    siteName: "MAHER PLATFORM PRO",
                    mainTitle: "مرحباً بك في المنصة الخاصة بنا",
                    titleMode: "text", // text or video
                    titleVideoUrl: "",
                    primaryColor: "#bc202b",
                    bgColor: "#0a0a0a",
                    surfaceColor: "#161616",
                    textColor: "#ffffff",
                    showSearch: true,
                    showTheme: true,
                    showLang: true
                },
                auth: {
                    keys: ["1234"] // مصفوفة الرموز (تدعم حتى 4 خانات)
                },
                ticker: {
                    active: true,
                    position: "top", // top, bottom, over-video
                    text: "هذا شريط خبر عاجل يمكن تخصيصه بالكامل من لوحة الإدارة...",
                    link: "",
                    duration: 0, // 0 يعني دائم
                    color: "#bc202b",
                    textColor: "#ffffff"
                },
                social: {
                    whatsapp: "",
                    facebook: "",
                    tiktok: "",
                    instagram: ""
                },
                sidebar: {
                    img: "https://via.placeholder.com/150",
                    title: "عرض الصورة",
                    desc: "وصف طويل جداً يظهر عند النقر على الصورة أو العنوان في القائمة الجانبية."
                },
                videos: [
                    { id: 1, t: "فيديو تجريبي", d: "هذا وصف للفيديو التجريبي", u: "https://www.youtube.com/watch?v=dQw4w9WgXcQ" }
                ],
                images: [],
                lang: "ar"
            },

            init() {
                const saved = localStorage.getItem('MAHER_PRO_DATA');
                if(saved) this.db = JSON.parse(saved);
                this.applyConfig();
                this.renderVideos();
                if(this.db.videos.length > 0) this.playVideo(this.db.videos[0].u);
            },

            // تطبيق الإعدادات على الواجهة
            applyConfig() {
                const r = document.documentElement.style;
                const c = this.db.config;
                r.setProperty('--primary-color', c.primaryColor);
                r.setProperty('--bg-color', c.bgColor);
                r.setProperty('--surface-color', c.surfaceColor);
                r.setProperty('--text-color', c.textColor);
                
                document.getElementById('ui-brand-name').innerText = c.siteName;
                document.getElementById('display-main-title').innerText = c.mainTitle;
                
                // البحث والثيم واللغة
                document.getElementById('btn-search-ui').style.display = c.showSearch ? 'block' : 'none';
                document.getElementById('btn-theme-ui').style.display = c.showTheme ? 'block' : 'none';
                document.getElementById('btn-lang-ui').style.display = c.showLang ? 'block' : 'none';

                // العنوان (فيديو أو نص)
                if(c.titleMode === 'video' && c.titleVideoUrl) {
                    document.getElementById('display-main-title').style.display = 'none';
                    const frame = document.getElementById('title-video-frame');
                    frame.style.display = 'block';
                    frame.innerHTML = `<iframe src="${this.formatYoutube(c.titleVideoUrl)}"></iframe>`;
                } else {
                    document.getElementById('display-main-title').style.display = 'block';
                    document.getElementById('title-video-frame').style.display = 'none';
                }

                // شريط الخبر
                this.updateTickerUI();

                // القائمة الجانبية
                document.getElementById('ui-sidebar-img').src = this.db.sidebar.img;
                document.getElementById('ui-sidebar-img-title').innerText = this.db.sidebar.title;
                document.getElementById('ui-sidebar-img-desc').innerText = this.db.sidebar.desc;
            },

            updateTickerUI() {
                const t = this.db.ticker;
                ['top', 'mid', 'bottom'].forEach(p => {
                    document.getElementById(`ticker-${p}`).style.display = 'none';
                });

                if(t.active) {
                    let target = 'top';
                    if(t.position === 'bottom') target = 'bottom';
                    if(t.position === 'over-video') target = 'mid';

                    const el = document.getElementById(`ticker-${target}`);
                    el.style.display = 'block';
                    el.style.setProperty('--ticker-bg', t.color);
                    el.style.setProperty('--ticker-text', t.textColor);
                    const txt = document.getElementById(`ui-ticker-text-${target}`);
                    txt.innerText = t.text;
                    if(t.link) {
                        el.onclick = () => window.open(t.link, '_blank');
                        el.style.cursor = 'pointer';
                    }
                }
            },

            renderVideos() {
                const container = document.getElementById('ui-video-list');
                container.innerHTML = this.db.videos.map((v, i) => `
                    <div class="video-card" onclick="App.playVideo('${v.u}', ${i})">
                        <img src="https://img.youtube.com/vi/${this.extractID(v.u)}/mqdefault.jpg">
                        <div class="video-card-info">
                            <div class="video-card-title">${v.t}</div>
                            <div class="video-card-desc" id="desc-${i}">${v.d}</div>
                        </div>
                    </div>
                `).join('');
            },

            playVideo(url, idx = -1) {
                const id = this.extractID(url);
                const player = document.getElementById('main-player-box');
                if(url.includes('youtube.com') || url.includes('youtu.be')) {
                    player.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1" allowfullscreen></iframe>`;
                } else {
                    player.innerHTML = `<video controls autoplay><source src="${url}"></video>`;
                }

                // إظهار الوصف عند النقر
                if(idx !== -1) {
                    const desc = document.getElementById(`desc-${idx}`);
                    const isVisible = desc.style.display === 'block';
                    document.querySelectorAll('.video-card-desc').forEach(d => d.style.display = 'none');
                    if(!isVisible) desc.style.display = 'block';
                }
                window.scrollTo({top: 0, behavior: 'smooth'});
            },

            extractID(url) {
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
                const match = url.match(regExp);
                return (match && match[2].length === 11) ? match[2] : null;
            },

            formatYoutube(url) {
                const id = this.extractID(url);
                return id ? `https://www.youtube.com/embed/${id}` : url;
            },

            // نظام الطبقات
            showLayer(id) {
                document.querySelectorAll('.page-layer').forEach(l => l.style.display = 'none');
                document.getElementById(id).style.display = 'block';
            },

            hideLayer(id) {
                document.getElementById(id).style.display = 'none';
                if(id === 'admin-layer' || id === 'login-layer') this.showLayer('layer-main');
                if(id === 'editor-layer') this.showLayer('admin-layer');
            },

            // تسجيل الدخول
            showLogin() {
                this.toggleSidebar(false);
                const container = document.getElementById('login-inputs-container');
                container.innerHTML = this.db.auth.keys.map((_, i) => `
                    <input type="password" class="login-input" placeholder="الرمز ${i+1}">
                `).join('');
                this.showLayer('login-layer');
            },

            verifyLogin() {
                const inputs = document.querySelectorAll('.login-input');
                let valid = true;
                inputs.forEach((inp, i) => {
                    if(inp.value !== this.db.auth.keys[i]) valid = false;
                });

                if(valid) {
                    this.showLayer('admin-layer');
                    this.updateAdminMediaList();
                } else {
                    alert("الرموز غير صحيحة!");
                }
            },

            // المحرر (Editor)
            openEditor(type, data = null) {
                const content = document.getElementById('editor-content');
                this.showLayer('editor-layer');
                
                let html = `<div class="editor-header">${this.getEditorTitle(type)}</div>`;

                switch(type) {
                    case 'add-video':
                        html += `
                            <input type="text" id="ed-v-url" placeholder="رابط الفيديو (يوتيوب أو مباشر)">
                            <input type="text" id="ed-v-title" placeholder="عنوان الفيديو">
                            <textarea id="ed-v-desc" rows="4" placeholder="صندوق الوصف"></textarea>
                            <button class="btn-save" onclick="App.saveMedia('video')">حفظ وحفظ</button>
                        `;
                        break;
                    case 'theme':
                        html += `
                            <div class="color-grid">
                                <div class="color-input-box">لون الأساس<input type="color" id="ed-c-primary" value="${this.db.config.primaryColor}"></div>
                                <div class="color-input-box">لون الخلفية<input type="color" id="ed-c-bg" value="${this.db.config.bgColor}"></div>
                                <div class="color-input-box">لون الأسطح<input type="color" id="ed-c-surface" value="${this.db.config.surfaceColor}"></div>
                                <div class="color-input-box">لون النصوص<input type="color" id="ed-c-text" value="${this.db.config.textColor}"></div>
                            </div>
                            <button class="btn-save" onclick="App.saveTheme()">حفظ الألوان</button>
                        `;
                        break;
                    case 'ticker':
                        html += `
                            <select id="ed-t-pos">
                                <option value="top" ${this.db.ticker.position==='top'?'selected':''}>أعلى الصفحة</option>
                                <option value="mid" ${this.db.ticker.position==='over-video'?'selected':''}>فوق الفيديو</option>
                                <option value="bottom" ${this.db.ticker.position==='bottom'?'selected':''}>أسفل الصفحة</option>
                            </select>
                            <input type="text" id="ed-t-text" placeholder="نص الخبر" value="${this.db.ticker.text}">
                            <input type="text" id="ed-t-link" placeholder="رابط (اختياري)" value="${this.db.ticker.link}">
                            <div class="color-grid">
                                <div class="color-input-box">لون الشريط<input type="color" id="ed-t-bg" value="${this.db.ticker.color}"></div>
                                <div class="color-input-box">لون النص<input type="color" id="ed-t-txt" value="${this.db.ticker.textColor}"></div>
                            </div>
                            <select id="ed-t-active">
                                <option value="true" ${this.db.ticker.active?'selected':''}>تفعيل</option>
                                <option value="false" ${!this.db.ticker.active?'selected':''}>إيقاف</option>
                            </select>
                            <button class="btn-save" onclick="App.saveTicker()">حفظ الشريط</button>
                        `;
                        break;
                    case 'avatar':
                        html += `
                            <input type="text" id="ed-s-img" placeholder="رابط الصورة المباشر" value="${this.db.sidebar.img}">
                            <input type="text" id="ed-s-title" placeholder="العنوان الظاهر" value="${this.db.sidebar.title}">
                            <textarea id="ed-s-desc" rows="5" placeholder="الوصف الذي يظهر عند النقر" value="">${this.db.sidebar.desc}</textarea>
                            <button class="btn-save" onclick="App.saveSidebar()">حفظ التغييرات</button>
                        `;
                        break;
                    case 'title-config':
                        html += `
                            <input type="text" id="ed-site-name" placeholder="اسم الموقع في الأعلى" value="${this.db.config.siteName}">
                            <input type="text" id="ed-main-title" placeholder="العنوان الترحيبي" value="${this.db.config.mainTitle}">
                            <select id="ed-title-mode" onchange="document.getElementById('ed-v-title-box').style.display = this.value==='video'?'block':'none'">
                                <option value="text" ${this.db.config.titleMode==='text'?'selected':''}>نص فقط</option>
                                <option value="video" ${this.db.config.titleMode==='video'?'selected':''}>عرض فيديو بدل النص</option>
                            </select>
                            <div id="ed-v-title-box" style="display:${this.db.config.titleMode==='video'?'block':'none'}">
                                <input type="text" id="ed-title-v-url" placeholder="رابط الفيديو الصغير" value="${this.db.config.titleVideoUrl}">
                            </div>
                            <button class="btn-save" onclick="App.saveSiteTitle()">حفظ هيبة الموقع</button>
                        `;
                        break;
                    case 'social':
                        html += `
                            <div class="social-admin-item"><i class="fab fa-whatsapp"></i> <input type="text" id="ed-soc-wa" value="${this.db.social.whatsapp}" placeholder="رابط أو رقم واتساب"></div>
                            <div class="social-admin-item"><i class="fab fa-facebook"></i> <input type="text" id="ed-soc-fb" value="${this.db.social.facebook}" placeholder="رابط فيسبوك"></div>
                            <div class="social-admin-item"><i class="fab fa-tiktok"></i> <input type="text" id="ed-soc-tk" value="${this.db.social.tiktok}" placeholder="رابط تيك توك"></div>
                            <div class="social-admin-item"><i class="fab fa-instagram"></i> <input type="text" id="ed-soc-ig" value="${this.db.social.instagram}" placeholder="رابط انستغرام"></div>
                            <button class="btn-save" onclick="App.saveSocial()">حفظ الروابط</button>
                        `;
                        break;
                    case 'security':
                        html += `
                            <p style="font-size:0.8rem; margin-bottom:10px;">يمكنك إضافة حتى 4 رموز دخول لزيادة الأمان</p>
                            <div id="ed-auth-container">
                                ${[0,1,2,3].map(i => `<input type="text" class="ed-auth-key" placeholder="الرمز ${i+1}" value="${this.db.auth.keys[i] || ''}">`).join('')}
                            </div>
                            <button class="btn-save" onclick="App.saveSecurity()">تحديث الأمان</button>
                        `;
                        break;
                }

                html += `<button class="btn-cancel" onclick="App.hideLayer('editor-layer')">خروج بدون حفظ</button>`;
                content.innerHTML = html;
            },

            getEditorTitle(type) {
                const titles = {
                    'add-video': 'إضافة فيديو جديد',
                    'theme': 'تخصيص الألوان',
                    'ticker': 'إعدادات الخبر العاجل',
                    'avatar': 'تغيير صورة وصندوق العرض',
                    'title-config': 'العنوان والهوية',
                    'social': 'روابط التواصل الاجتماعي',
                    'security': 'إعدادات الوصول'
                };
                return titles[type] || 'تعديل';
            },

            // وظائف الحفظ الفرعية
            saveMedia(type) {
                if(type === 'video') {
                    const v = {
                        id: Date.now(),
                        u: document.getElementById('ed-v-url').value,
                        t: document.getElementById('ed-v-title').value,
                        d: document.getElementById('ed-v-desc').value
                    };
                    if(!v.u) return alert("الرابط مطلوب!");
                    this.db.videos.push(v);
                }
                this.hideLayer('editor-layer');
                this.updateAdminMediaList();
            },

            saveTheme() {
                this.db.config.primaryColor = document.getElementById('ed-c-primary').value;
                this.db.config.bgColor = document.getElementById('ed-c-bg').value;
                this.db.config.surfaceColor = document.getElementById('ed-c-surface').value;
                this.db.config.textColor = document.getElementById('ed-c-text').value;
                this.hideLayer('editor-layer');
            },

            saveTicker() {
                this.db.ticker.active = document.getElementById('ed-t-active').value === 'true';
                this.db.ticker.position = document.getElementById('ed-t-pos').value === 'mid' ? 'over-video' : document.getElementById('ed-t-pos').value;
                this.db.ticker.text = document.getElementById('ed-t-text').value;
                this.db.ticker.link = document.getElementById('ed-t-link').value;
                this.db.ticker.color = document.getElementById('ed-t-bg').value;
                this.db.ticker.textColor = document.getElementById('ed-t-txt').value;
                this.hideLayer('editor-layer');
            },

            saveSidebar() {
                this.db.sidebar.img = document.getElementById('ed-s-img').value;
                this.db.sidebar.title = document.getElementById('ed-s-title').value;
                this.db.sidebar.desc = document.getElementById('ed-s-desc').value;
                this.hideLayer('editor-layer');
            },

            saveSiteTitle() {
                this.db.config.siteName = document.getElementById('ed-site-name').value;
                this.db.config.mainTitle = document.getElementById('ed-main-title').value;
                this.db.config.titleMode = document.getElementById('ed-title-mode').value;
                this.db.config.titleVideoUrl = document.getElementById('ed-title-v-url').value;
                this.hideLayer('editor-layer');
            },

            saveSocial() {
                this.db.social.whatsapp = document.getElementById('ed-soc-wa').value;
                this.db.social.facebook = document.getElementById('ed-soc-fb').value;
                this.db.social.tiktok = document.getElementById('ed-soc-tk').value;
                this.db.social.instagram = document.getElementById('ed-soc-ig').value;
                this.hideLayer('editor-layer');
            },

            saveSecurity() {
                const keys = Array.from(document.querySelectorAll('.ed-auth-key')).map(i => i.value).filter(v => v !== "");
                if(keys.length === 0) return alert("يجب وجود رمز واحد على الأقل!");
                this.db.auth.keys = keys;
                this.hideLayer('editor-layer');
            },

            deleteVideo(id) {
                this.db.videos = this.db.videos.filter(v => v.id !== id);
                this.updateAdminMediaList();
            },

            updateAdminMediaList() {
                const container = document.getElementById('admin-media-list');
                container.innerHTML = this.db.videos.map(v => `
                    <div class="admin-item" style="font-size:0.8rem">
                        <span>${v.t}</span>
                        <button class="btn-delete" style="width:auto; padding:5px 10px;" onclick="App.deleteVideo(${v.id})">حذف</button>
                    </div>
                `).join('');
            },

            // الحفظ النهائي
            finalSaveAll() {
                localStorage.setItem('MAHER_PRO_DATA', JSON.stringify(this.db));
                this.applyConfig();
                this.renderVideos();
                this.hideLayer('admin-layer');
                alert("تم حفظ جميع الإعدادات وتطبيقها!");
            },

            // واجهة المستخدم التفاعلية
            toggleSidebar(show) {
                document.getElementById('sidebar').classList.toggle('active', show);
                document.getElementById('sidebar-overlay').style.display = show ? 'block' : 'none';
            },

            toggleSidebarDesc() {
                const desc = document.getElementById('ui-sidebar-img-desc');
                desc.style.display = desc.style.display === 'block' ? 'none' : 'block';
            },

            toggleSearch() {
                const q = prompt("ابحث عن فيديو:");
                if(q) {
                    const results = this.db.videos.filter(v => v.t.includes(q));
                    alert("وجدنا " + results.length + " فيديو");
                }
            },

            toggleTheme() {
                const isDark = this.db.config.bgColor === '#0a0a0a';
                this.db.config.bgColor = isDark ? '#ffffff' : '#0a0a0a';
                this.db.config.surfaceColor = isDark ? '#f0f0f0' : '#161616';
                this.db.config.textColor = isDark ? '#1a1a1a' : '#ffffff';
                this.applyConfig();
            },

            showLangSwitcher() {
                const l = prompt("اختر اللغة (ar, en, fr, he):");
                if(l) {
                    this.db.lang = l;
                    alert("تم تحويل اللغة إلى " + l);
                }
            },

            socialRedirect(platform) {
                const url = this.db.social[platform];
                if(!url) return alert("الرابط غير مضاف!");
                
                this.toggleSidebar(false);
                const layer = document.getElementById('redirect-layer');
                const timerEl = document.getElementById('redir-timer');
                layer.style.display = 'flex';
                
                let count = 3;
                timerEl.innerText = count;
                const interval = setInterval(() => {
                    count--;
                    timerEl.innerText = count;
                    if(count <= 0) {
                        clearInterval(interval);
                        layer.style.display = 'none';
                        window.open(url.startsWith('http') ? url : 'https://wa.me/' + url, '_blank');
                    }
                }, 1000);
            }
        };

        // تشغيل التطبيق
        window.onload = () => App.init();

        // منع التكبير اليدوي
        document.addEventListener('touchstart', function (event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
                                                                                                                   </html>
